"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ChapterScraper = void 0;
class ChapterScraper {
    constructor(html) {
        this.html = html;
    }
    getChapters() {
        var _a, _b, _c;
        const regex = /({"multiMarkersPlayerBarRenderer":{"visibleOnLoad":{(.*?)},"markersMap":\[{"key":(.*?),"value":{(.*?)}}(|,{"key":(.*?),"value":{.*?}})\]}}(}}]}})?)/;
        const matches = regex.exec(this.html);
        if (!(matches === null || matches === void 0 ? void 0 : matches.length))
            return [];
        const { multiMarkersPlayerBarRenderer } = JSON.parse(`${matches[0]}`);
        const list = (_b = (_a = multiMarkersPlayerBarRenderer === null || multiMarkersPlayerBarRenderer === void 0 ? void 0 : multiMarkersPlayerBarRenderer.markersMap[0]) === null || _a === void 0 ? void 0 : _a.value) === null || _b === void 0 ? void 0 : _b.chapters;
        if (!list)
            return [];
        let chapters = [];
        for (let [index, entry] of list.entries()) {
            const content = entry;
            const chapter = content.chapterRenderer;
            if (!chapter)
                continue;
            const nextContent = list[index + 1];
            const title = chapter.title.simpleText;
            const start = chapter.timeRangeStartMillis; // ms
            const end = (((_c = nextContent === null || nextContent === void 0 ? void 0 : nextContent.chapterRenderer) === null || _c === void 0 ? void 0 : _c.timeRangeStartMillis) - 1) || null; // ms
            chapters = [...chapters, {
                    title,
                    start: start / 1000,
                    end: end ? end / 1000 : null // s
                }];
        }
        return chapters;
    }
}
exports.ChapterScraper = ChapterScraper;
//# sourceMappingURL=chapter.js.map